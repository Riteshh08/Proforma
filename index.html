<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proforma Invoice Generator</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <style>
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
            color: #333;
        }

        .container {
            background: #fff;
            padding: 30px;
            max-width: 800px;
            margin: auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #444;
        }

        .section-title {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: bold;
            border-bottom: 2px solid #eee;
            padding-bottom: 5px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }

        .product-row {
            background: #f9f9f9;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-start;
        }

        .col-lg { flex: 3; min-width: 250px; }
        .col-sm { flex: 1; min-width: 80px; }

        /* Style for the custom input that appears/disappears */
        .custom-input-wrapper {
            margin-top: 5px;
            display: none; /* Hidden by default */
        }

        button {
            padding: 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-add { background-color: #28a745; color: white; }
        .btn-add:hover { background-color: #218838; }

        .btn-gen { background-color: #007bff; color: white; width: 100%; margin-top: 20px; }
        .btn-gen:hover { background-color: #0069d9; }

        .btn-del { background-color: #dc3545; color: white; padding: 5px 10px; font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Proforma Invoice Generator</h2>

        <div class="section-title">Client Details</div>
        <div class="input-group">
            <label>Date:</label>
            <input type="date" id="date" />
        </div>
        <div class="input-group">
            <label>Client Name:</label>
            <input type="text" id="name" placeholder="e.g. M/s ABC Pvt Ltd" />
        </div>
        <div class="input-group">
            <label>Client Address:</label>
            <input type="text" id="address" placeholder="e.g. 123 Main Street" />
        </div>
        <div class="input-group">
            <label>Mobile No:</label>
            <input type="text" id="mobile" placeholder="+91-XXXXXXXXXX" />
        </div>
        <div class="input-group">
            <label>Client GST No:</label>
            <input type="text" id="gst" placeholder="22AAAAA0000A1Z5" />
        </div>

        <div class="section-title">Products</div>
        <div id="products-container"></div>
        <button class="btn-add" onclick="addProduct()">+ Add Product</button>

        <div class="section-title">Terms & Calculations</div>
        <div class="input-group">
            <label>GST Rate:</label>
            <select id="gstRate">
                <option value="18">18%</option>
                <option value="5">5%</option>
                <option value="12">12%</option>
                <option value="0">0%</option>
            </select>
        </div>
        <div class="input-group">
            <label>Advance Payment Option:</label>
            <select id="advance">
                <option value="100% ADVANCE PAYMENT">100% ADVANCE PAYMENT</option>
                <option value="50% ADVANCE & 50% BEFORE DISPATCH">50% ADVANCE & 50% BEFORE DISPATCH</option>
            </select>
        </div>
        <div class="input-group">
            <label>Transport Charges:</label>
            <select id="transport">
                <option value="TRANSPORT CHARGES EXTRA / TO PAY">TRANSPORT CHARGES EXTRA / TO PAY</option>
                <option value="INCLUDED">INCLUDED</option>
                <option value="NONE">NONE</option>
            </select>
        </div>

        <button class="btn-gen" onclick="generatePDF()">Download PDF</button>
    </div>

    <script>
        // ==========================================
        //  CONFIGURATION: EDIT YOUR DETAILS HERE
        // ==========================================
        
        // 1. Image Filenames (Must be in same folder)
        const LOGO_FILENAME = "logo.png";
        const QR_FILENAME = "qr-code.png";

        // 2. Your Company Details
        const COMPANY_NAME = "SHREE DATTA TRUNK & UMBRELLA MART";
        const COMPANY_ADDRESS = "1099,BUDHWAR PETH, NEXT TO DATTA MANDIR, PUNE 411002";
        const COMPANY_CONTACT = "Phone: +91-93729 49460 | Email: sales@anchorumbrella.com";
        const COMPANY_GST = "27ACPFS2215Q1ZH";
        const COMPANY_PAN = "ACPFS2215Q";

        // 3. Your Bank Details
        const BANK_DETAILS = {
            bankName: "Bank Of India ,Pune City Branch.",
            acName: "Shree Datta Trunk & Umbrella Mart",
            acNo: "050630100000042",
            acType: "C/C. A/c",
            ifsc: "BKID0000506",
            upiId: "boim-050694600042@boi"
        };

        // ==========================================
        //  END CONFIGURATION
        // ==========================================

        document.getElementById('date').valueAsDate = new Date();
        let productCount = 0;

        addProduct();

        function addProduct() {
            productCount++;
            const container = document.getElementById("products-container");
            const div = document.createElement("div");
            div.className = "product-row";
            div.id = `row-${productCount}`;
            
            div.innerHTML = `
                <div class="col-lg">
                    <label>Product</label>
                    <select id="select${productCount}" onchange="toggleCustomInput(${productCount})">
                        <option value="UMBRELLA">UMBRELLA</option>
                        <option value="GAZEBO">GAZEBO</option>
                        <option value="PROMO TABLE">PROMO TABLE</option>
                        <option value="CANOPY">CANOPY</option>
                        <option value="TRANSPORT CHARGES">TRANSPORT CHARGES</option>
                        <option value="CUSTOM">-- Other / Custom --</option>
                    </select>
                    
                    <div id="customWrapper${productCount}" class="custom-input-wrapper">
                        <input type="text" id="customName${productCount}" placeholder="Type product name here..." />
                    </div>

                    <label style="margin-top:10px;">Description</label>
                    <textarea id="desc${productCount}" rows="2" placeholder="Details (Size, Color, etc.)"></textarea>
                </div>
                <div class="col-sm">
                    <label>Qty</label>
                    <input type="number" id="qty${productCount}" value="1" min="1" />
                </div>
                <div class="col-sm">
                    <label>Rate (Rs)</label>
                    <input type="number" id="rate${productCount}" value="0" min="0" step="0.01" />
                </div>
                <div style="width:100%; text-align:right;">
                   <button class="btn-del" onclick="removeProduct(${productCount})">Remove Item</button>
                </div>
            `;
            container.appendChild(div);
        }

        function toggleCustomInput(id) {
            const select = document.getElementById(`select${id}`);
            const wrapper = document.getElementById(`customWrapper${id}`);
            
            if (select.value === "CUSTOM") {
                wrapper.style.display = "block";
                document.getElementById(`customName${id}`).focus();
            } else {
                wrapper.style.display = "none";
            }
        }

        function removeProduct(id) {
            const row = document.getElementById(`row-${id}`);
            if(row) row.remove();
        }

        function loadImage(url) {
            return new Promise((resolve) => {
                const img = new Image();
                img.src = url;
                img.onload = () => resolve(img);
                img.onerror = () => {
                    console.warn(`Image not found: ${url}`);
                    resolve(null);
                };
            });
        }

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const logoImg = await loadImage(LOGO_FILENAME);
            const qrImg = await loadImage(QR_FILENAME);

            let x = 15;
            let y = 15;

            // --- HEADER ---
            doc.setFont("times", "bold");
            doc.setFontSize(22);
            doc.text("PROFORMA INVOICE", 105, y, { align: "center" });
            
            y += 10;

            if (logoImg) {
                doc.addImage(logoImg, "PNG", x, y, 25, 25); 
            }

            doc.setFontSize(10);
            doc.setFont("times", "normal");
            doc.text(COMPANY_NAME, 105, y + 5, { align: "center" }); 
            doc.text(COMPANY_ADDRESS, 105, y + 10, { align: "center" });
            doc.text(COMPANY_CONTACT, 105, y + 15, { align: "center" });

            const inputDate = document.getElementById("date").value;
            const dateObj = new Date(inputDate);
            const formattedDate = `${String(dateObj.getDate()).padStart(2, '0')}/${String(dateObj.getMonth() + 1).padStart(2, '0')}/${dateObj.getFullYear()}`;
            
            doc.setFont("times", "bold");
            doc.text(`Date: ${formattedDate}`, 195, y + 15, { align: "right" });

            y += 35; 

            // --- CLIENT DETAILS ---
            doc.setFontSize(11);
            doc.text("To,", x, y);
            doc.setFont("times", "normal");
            doc.text("M/s: " + document.getElementById("name").value, x, y + 6);
            doc.text("Address: " + document.getElementById("address").value, x, y + 12);
            doc.text("Mobile: " + document.getElementById("mobile").value, x, y + 18);
            doc.text("GST No: " + document.getElementById("gst").value, x, y + 24);

            y += 30; 

            // --- TABLE DATA ---
            const rows = [];
            const container = document.getElementById("products-container");
            const productDivs = container.getElementsByClassName("product-row");
            
            let subtotal = 0;
            let srNo = 1;

            for (let div of productDivs) {
                const select = div.querySelector("select");
                const customInput = div.querySelector("input[id^='customName']");
                const descArea = div.querySelector("textarea");
                const qtyInput = div.querySelector("input[id^='qty']");
                const rateInput = div.querySelector("input[id^='rate']");
                
                let pName = select.value;
                if (pName === "CUSTOM") {
                    pName = customInput.value;
                }

                const pDesc = descArea.value;
                const qty = parseFloat(qtyInput.value) || 0;
                const rate = parseFloat(rateInput.value) || 0;
                const amount = qty * rate;

                subtotal += amount;

                const itemContent = pDesc ? `${pName}\n(${pDesc})` : pName;

                rows.push([
                    srNo++,
                    itemContent,
                    qty,
                    `Rs. ${rate.toFixed(2)}`,
                    `Rs. ${amount.toFixed(2)}`
                ]);
            }

            const gstPercent = parseFloat(document.getElementById("gstRate").value);
            const gstAmount = subtotal * (gstPercent / 100);
            const total = subtotal + gstAmount;

            rows.push([
                { content: "Subtotal", colSpan: 4, styles: { halign: "right", fontStyle: "bold" } },
                { content: `Rs. ${subtotal.toFixed(2)}` }
            ]);
            rows.push([
                { content: `GST (${gstPercent}%)`, colSpan: 4, styles: { halign: "right", fontStyle: "bold" } },
                { content: `Rs. ${gstAmount.toFixed(2)}` }
            ]);
            rows.push([
                { content: "Grand Total", colSpan: 4, styles: { halign: "right", fontStyle: "bold", fillColor: [240, 240, 240] } },
                { content: `Rs. ${Math.round(total).toLocaleString("en-IN")}`, styles: { fontStyle: "bold", fillColor: [240, 240, 240] } }
            ]);

            doc.autoTable({
                startY: y,
                head: [["Sr", "Description of Goods", "Qty", "Rate", "Amount"]],
                body: rows,
                theme: 'grid',
                styles: { 
                    font: "times", 
                    fontSize: 10,
                    cellPadding: 3,
                    valign: 'middle'
                },
                columnStyles: {
                    0: { cellWidth: 10, halign: 'center' },
                    1: { cellWidth: 'auto' }, 
                    2: { cellWidth: 15, halign: 'center' },
                    3: { cellWidth: 25, halign: 'right' },
                    4: { cellWidth: 30, halign: 'right' }
                },
                headStyles: {
                    fillColor: [60, 60, 60],
                    textColor: 255,
                    fontStyle: "bold"
                }
            });

            // --- FOOTER ---
            let finalY = doc.lastAutoTable.finalY + 10;
            
            if (finalY > 240) {
                doc.addPage();
                finalY = 20;
            }

            const bankX = 15;
            const qrX = 140; 

            doc.setFontSize(10);
            doc.setFont("times", "bold");
            doc.text("Payment Terms:", bankX, finalY);
            doc.setFont("times", "normal");
            doc.text(document.getElementById("advance").value, bankX, finalY + 5);
            
            doc.setFont("times", "bold");
            doc.text("Transport:", bankX, finalY + 12);
            doc.setFont("times", "normal");
            doc.text(document.getElementById("transport").value, bankX, finalY + 17);

            let bankY = finalY + 28;
            doc.setFont("times", "bold");
            doc.text("Bank Details for NEFT/RTGS:", bankX, bankY);
            doc.setFont("times", "normal");
            bankY += 6;
            doc.text("Bank Name: " + BANK_DETAILS.bankName, bankX, bankY);
            bankY += 5;
            doc.text("A/c Name: " + BANK_DETAILS.acName, bankX, bankY);
            bankY += 5;
            doc.text("A/c No: " + BANK_DETAILS.acNo, bankX, bankY);
            bankY += 5;
            doc.text("A/c Type: " + BANK_DETAILS.acType, bankX, bankY);
            bankY += 5;
            doc.text("IFSC Code: " + BANK_DETAILS.ifsc, bankX, bankY);

            if (qrImg) {
                doc.addImage(qrImg, "PNG", qrX, finalY + 25, 30, 30);
                doc.setFontSize(9);
                doc.text("UPI: " + BANK_DETAILS.upiId, qrX + 15, finalY + 60, { align: "center" }); 
            }

            const footerY = bankY + 40;
            doc.setFontSize(10);
            doc.setFont("times", "normal");
            doc.text("GSTIN: " + COMPANY_GST, bankX, footerY);
            doc.text("PAN: " + COMPANY_PAN, bankX, footerY + 5);

            doc.setFont("times", "bold");
            doc.text("For " + COMPANY_NAME, 195, footerY - 5, { align: "right" });
            doc.text("Authorized Signatory", 195, footerY + 15, { align: "right" });

            // --- SAVE AS CLIENT NAME ---
            let clientName = document.getElementById("name").value.trim();
            // Replace / and \ with _ to prevent errors, fallback to 'Invoice' if empty
            let safeName = clientName.replace(/[\/\\:*?"<>|]/g, "_") || "Invoice";
            
            doc.save(`${safeName}.pdf`);
        }
    </script>
</body>
</html>
